"use strict";let parser=null;const stringToHTML=e=>{e=(parser=parser||new DOMParser).parseFromString(e,"text/html");return 1===e.body.children.length?e.body.children[0]:e.body.children},fetchHtmlContent=(e,t,i)=>{fetch(e.toLowerCase()).then(e=>{if(e.ok)return e.text();throw new Error("HTTP error, status = "+e.status)}).then(e=>{t(e)}).catch(e=>{i(e)})},debounce=(t,i)=>{let s=null;return(...e)=>{window.clearTimeout(s),s=window.setTimeout(()=>{t.apply(null,e)},i)}},find=(e,t)=>t?e.querySelector(t):find(getDocument(),e),findAll=(e,t)=>t?e.querySelectorAll(t):findAll(getDocument(),e),isType=(e,t)=>Object.prototype.toString.call(e)==="[object "+t+"]",isFunction=e=>isType(e,"Function"),makeEvent=(e,t={})=>{var i;return window.CustomEvent&&"function"==typeof window.CustomEvent?i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t}):(i=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),i},logError=e=>{console.error?console.error(e):console.log&&console.log("ERROR: ",e)},triggerEvent=(e,t,i)=>{(i=null==i?{}:i).el=e;t=makeEvent(t,i);return i.error&&(logError(i.error),triggerEvent(e,"app:error",{errorInfo:i})),e.dispatchEvent(t)};function getDocument(){return document}function resolveTarget(e){return isType(e,"String")?find(e):e}function processEventArgs(e,t,i,s){return isFunction(t)?{target:getDocument().body,event:e,listener:t,options:i}:{target:resolveTarget(e),event:t,listener:i,options:s}}const on=(e,t,i,s)=>{e=processEventArgs(e,t,i);return(e.currentTarget||e.target).addEventListener(e.event,e.listener,e.options),isFunction(t)?t:i},Store=class extends EventTarget{constructor(){super(),this.categories=[],this.visibleItems=[],this.searchCategory="",this.searchTerm="",this.details=null,this.data={}}_onUpdated(){triggerEvent(this,"store:updated")}_onInitialized(){triggerEvent(this,"store:initialized")}init(e){this.categories=[...new Set([...this.categories,...e])]}initCategory(e,t){this.categories.includes(e)&&(this.searchCategory=e,this.data[e]=t||[]),this._onInitialized()}isCategoryValid(e){return this.categories.includes(e)&&this.data[e]&&0<this.data[e].length}add({name:e,content:t,type:i,prefab:s,template:o}=item){this.items.push({name:e,content:t,type:i,prefab:s,template:o}),this._onUpdated()}search(e,i){var t;this.categories.includes(e)?(this.searchCategory=e,i?(this.searchTerm=i,e=this.data[e],this.visibleItems=e.filter(t=>Object.keys(t).some(e=>!("template"===e||!isType(t[e],"String"))&&t[e].toLowerCase().includes(i.toLowerCase()))),1<this.visibleItems.length&&(e=null,0<=(t=this.visibleItems.findIndex(e=>e.name.toLowerCase()===i.toLowerCase()||e.prefab.toLowerCase()===i.toLowerCase())))&&(e=this.visibleItems[t],this.visibleItems.splice(t,1),this.visibleItems.unshift(e))):(this.searchTerm="",this.visibleItems.length=0)):this.searchCategory=this.categories[0],this.details=null,this._onUpdated()}viewDetails(e){this.details=e||null,this._onUpdated()}clear(){this.details=null,this.searchTerm="",this.visibleItems.length=0,this._onUpdated()}},Toggle=class{constructor(){this.controller=null,this.availableStates=[],this.currentState=null}init(){}bindEvents(){this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller,this.availableStates.length=0,findAll("[data-toggle]").forEach(e=>{e=e?.dataset?.toggle;e&&!this.availableStates.includes(e)&&this.availableStates.push(e)}),findAll("[data-toggle-trigger]").forEach(e=>{var t=e?.dataset?.toggleTrigger;t&&!this.availableStates.includes(t)&&console.error(`Error binding trigger state:  ${t} is not an available state to trigger`),on(e,"click",e=>this.onClick(e))}),find("[data-toggle-parent]")?.classList.remove("invisible"),0<this.availableStates.length&&this.trigger(this.availableStates[0])}onClick(e){e=(e.currentTarget||e.target).dataset.toggleTrigger;this.availableStates.includes(e)?this.trigger(e):console.error(`Error triggering state:  ${e} is not an available state`)}trigger(t){this.currentState!==t&&(findAll("[data-toggle]").forEach(e=>{e?.dataset?.toggle===t?e.classList.remove("hidden"):e.classList.add("hidden")}),this.currentState=t)}};function processTooltipUrl(e){return e&&0<e.length&&(e+="/tooltip.html"),e}function processModalUrl(e){return e&&0<e.length&&(e+="/partial.html"),e}function copyTouch({identifier:e,pageX:t,pageY:i}){return{identifier:e,pageX:t,pageY:i}}const Tooltip=class{constructor(e=!1){this.visible=!1,this.currentHref="",this.x=0,this.y=0,this.mouseX=0,this.mouseY=0,this.hostEl=null,this.contentEl=null,this.modalDialogEl=null,this.modalFormEl=null,this.modalContentEl=null,this.controller=null,this.isTouchDragging=!1,this.changedTouch=null,this.isMobile=e}init(){this.hostEl=find("[data-tooltip-host]"),this.modalDialogEl=find("[data-tooltip-dialog]")}bindEvents(){this.controller&&this.controller.abort(),this.controller=new AbortController,this.isMobile?this.bindMobileEvents():this.bindDesktopEvents()}bindMobileEvents(){this.controller,on(this.modalDialogEl,"close",debounce(e=>this.closeModal(e),100)),findAll("a[data-tooltip]").forEach(e=>{on(e,"touchstart",e=>this.onTouchStart(e)),on(e,"touchmove",e=>this.onTouchMove(e)),on(e,"touchend",e=>this.onTouchEnd(e)),on(e,"click",e=>this.disableClick(e))})}bindDesktopEvents(){var e=this.controller["signal"];on("mousemove",e=>{this.visible&&this.contentEl&&(this.setCoords(e,window),this.contentEl.style.left=this.x+"px",this.contentEl.style.top=this.y+"px")},{signal:e}),findAll("a[data-tooltip]").forEach(e=>{on(e,"mouseover",e=>this.setVisibility(!0,e)),on(e,"mouseleave",e=>this.setVisibility(!1))})}hideAll(){this.closeModal(),this.setVisibility(!1)}closeModal(){this.modalContentEl&&(find(this.modalDialogEl,"[data-tooltip-form]")?.replaceChildren(),this.modalContentEl=null,triggerEvent(this.modalDialogEl,"tooltip:updated",{state:"closed"}))}setCoords(e,{innerWidth:t=0,innerHeight:i=0,pageXOffset:s=0,pageYOffset:o=0}=measurements){let a=0,l=0,n=this.mouseX,r=this.mouseY;e&&(n=this.mouseX=e.clientX,r=this.mouseY=e.clientY);e=this.contentEl?.offsetWidth||300,a=n+e+40>t?n-e-15:n+15,t=this.contentEl?.offsetHeight||200;l=r+t+40>i?r-t-15:r+15,this.x=a+s,this.y=l+o}setVisibility(e,i){e=!!e;let s=i?.currentTarget;var o=processTooltipUrl(s?.getAttribute("href"));if(e){if(this.visible===e&&this.currentHref===o)return;this.visible=e,this.currentHref=o,null==this.contentEl&&(this.contentEl=document.createElement("div"),this.contentEl.setAttribute("data-tooltip-content",""),this.contentEl.setAttribute("class","tooltip-content z-10 bg-base-300 invisible"),this.contentEl.setAttribute("style",`display:block; position:absolute; width:300px; min-height:100px; left:${this.x}px; top:${this.y}px; `),this.hostEl.appendChild(this.contentEl));let t=setTimeout(()=>{s?.classList.add("cursor-progress")},300);o&&fetchHtmlContent(o,e=>{e=stringToHTML(e);this.visible&&this.contentEl&&(this.contentEl.replaceChildren(e),this.setCoords(i,window),debounce(()=>{this.visible&&this.contentEl&&(clearTimeout(t),s?.classList.remove("cursor-progress"),this.contentEl.classList.remove("invisible"),this.contentEl.style.left=this.x+"px",this.contentEl.style.top=this.y+"px")},0)())},e=>{console.log(e)})}else s?.classList.remove("cursor-progress"),this.contentEl&&(this.hostEl.replaceChildren(),this.contentEl=null,this.currentHref=null,this.visible=e);triggerEvent(document.body,"tooltip:updated")}disableClick(e){this.isMobile&&e.preventDefault(),console.log(e,this.isMobile)}onTouchStart(e){this.isTouchDragging=!1;e=e.changedTouches;e&&0<e.length&&(this.changedTouch=copyTouch(e[0]))}onTouchMove(e){if(!this.isTouchDragging){var t=e.changedTouches;for(let e=0;e<t.length;e++)if(this.changedTouch.identifier===t[e].identifier){var i=Math.abs(this.changedTouch.pageX-t[e].pageX),s=Math.abs(this.changedTouch.pageY-t[e].pageY);t[e].pageX,i<6&&s<6?(this.isTouchDragging=!1,console.log("drag detection: false")):(this.isTouchDragging=!0,console.log("drag detection: true"));break}}}onTouchEnd(e){if(this.onTouchMove(e),!this.isTouchDragging){e.preventDefault(),this.modalDialogEl.showModal();let t=find(this.modalDialogEl,"[data-tooltip-form]");null!=this.modalContentEl&&(t.replaceChildren(),this.modalContentEl=null),this.modalContentEl=stringToHTML('<div class="text-center"><span class="loading loading-spinner loading-md text-stat-gold"></span></div>'),t.replaceChildren(this.modalContentEl),e&&e.currentTarget&&(e=processModalUrl(e.currentTarget.getAttribute("href")),fetchHtmlContent(e,e=>{e=stringToHTML(e);this.modalContentEl&&(this.modalContentEl=document.createElement("div"),t.replaceChildren(this.modalContentEl.appendChild(e)),triggerEvent(this.modalDialogEl,"tooltip:updated",{state:"opened"}))},e=>{console.log(e)}))}this.changedTouch=null,this.isTouchDragging=!1}},findNavOptions=e=>{var t=[];for(const i of e)t.push({category:i.dataset.nav,text:i.innerText,url:new URL(i.href)});return t},getInitialCategory=(e,t)=>{if(e&&e.category)for(const s of t)if(s.category===e.category)return{category:s.category,url:s.url};var i=new URL(window.location)?.pathname??"";if(!i.hash)for(const o of t)if(i.includes(o.category))return{category:o.category,url:o.url};return{category:t[0].category,url:t[0].url}},convertHtmlToItems=t=>{var i,s=[];let o=null;if(t&&t.children&&0<t.children.length?(o=t.children,console.log(t)):t&&0<t.length&&(o=t),o){let e=0;for(const t of o)"SCRIPT"!==t.nodeName&&(i={id:e+=1,name:find(t,"[data-name]")?.dataset.name,content:find(t,"[data-content]")?.dataset.content,type:find(t,"[data-type]")?.dataset.type,prefab:find(t,"[data-prefab]")?.dataset.prefab,template:t.outerHTML},s.push(i))}return s},parseHash=e=>{let t="",i="";e=decodeURIComponent(e).split(/\+/);return 0<e.length&&e[0]&&(t=e[0]),1<e.length&&e[1]&&(i=e[1]),{category:t,search:i}},onFinishNavigation=(e,t)=>{history.pushState(null,null,`#${e}+`+t),window.scrollTo(0,0)},cleanTerm=e=>0<=e.indexOf("/")?e.substring(e.lastIndexOf("/")+1):e,Tooltips=new Tooltip(!!window.mobileAndTabletCheck&&window.mobileAndTabletCheck()),Model=new Store,Toggles=new Toggle;let signaller=null;const App={isMobile:!1,baseurl:"",view:{navList:find("[data-nav-list]"),searchForm:find("[data-search-form]"),searchInput:find("[data-search-input]"),searchButton:find("[data-search-button]"),clearButton:find("[data-search-clear]"),searchResults:find("[data-search-results]")},init(e,t){App.isMobile=t,App.baseurl=e,App.view.searchForm.classList.remove("hidden"),App.view.navList.classList.remove("-mt-6"),App.view.searchResults.classList.add("invisible");let i=parseHash(window.location.hash.substring(1));t=findAll(App.view.navList,"[data-nav]"),e=findNavOptions(t);let s=getInitialCategory(i,e);Model.init(e.map(e=>e.category)),on(Model,"store:updated",App.render),on(window,"popstate",e=>{var t=parseHash(window.location.hash.substring(1));"details"===t.category?App.goToDetails(t.search,!1):App.goToCategory(t.category,t.search,!1),document.activeElement.blur()}),Tooltips.init(),Toggles.init(),on(document.body,"tooltip:updated",e=>{e.detail&&"opened"===e.detail.state&&App.bindItemNavEvents(e.currentTarget)}),1<App.view.searchResults.children.length?debounce(()=>{var e=convertHtmlToItems(App.view.searchResults);Model.initCategory(s.category,e),history.replaceState(null,null,`${App.baseurl}/#${s.category}+`)})():(App.view.searchResults.classList.remove("invisible"),App.view.searchResults.replaceChildren(stringToHTML('<div class="text-center"><span class="loading loading-spinner loading-md text-stat-gold"></span></div>')),fetchHtmlContent(s.url.pathname+"/all.html",e=>{e=stringToHTML(e),e=convertHtmlToItems(e);Model.initCategory(s.category,e)},e=>{console.log(e)})),on(App.view.searchInput,"keyup",e=>{"Enter"===e.key&&(Model.search(Model.searchCategory,App.view.searchInput.value),onFinishNavigation(Model.searchCategory,App.view.searchInput.value))}),on(App.view.searchButton,"click",e=>{Model.search(Model.searchCategory,App.view.searchInput.value),onFinishNavigation(Model.searchCategory,App.view.searchInput.value)}),on(App.view.clearButton,"click",e=>{App.view.searchInput.value="",Model.clear(),onFinishNavigation(Model.searchCategory,App.view.searchInput.value)}),on(App.view.searchForm,"submit",e=>{e.preventDefault()}),t.forEach(e=>{on(e,"click",e=>{e.preventDefault();e=new URL(e.currentTarget.href).pathname.replace(App.baseurl+"/","");let t=Model.searchTerm;!t&&Model.details&&(t=Model.details?.path),App.goToCategory(e,cleanTerm(t))})}),on(Model,"store:initialized",()=>{App.view.searchResults.classList.remove("invisible"),"details"===parseHash(window.location.hash.substring(1)).category?App.goToDetails(i.search):Model.searchCategory&&Model.searchTerm?Model.search(Model.searchCategory,Model.searchTerm):i&&i.category&&i.search?(App.view.searchInput.value=i.search,Model.search(i.category,i.search)):Model._onUpdated()})},goToDetails(t,i=!0){App.view.searchResults.replaceChildren(stringToHTML('<div class="text-center"><span class="loading loading-spinner loading-md text-stat-gold"></span></div>')),fetchHtmlContent(App.baseurl+t+"/all.html",e=>{e=stringToHTML(e),e={type:find(e,"[data-type]")?.dataset.type,path:t,content:e};Model.viewDetails(e),Toggles.bindEvents(),i&&onFinishNavigation("details",t)},e=>{console.log(e);e={path:t,content:"asfasfasf"};Model.viewDetails(e)}),Tooltips.hideAll()},goToCategory(t,i,s=!0){Model.isCategoryValid(t)?(Model.search(t,i),App.view.searchInput.value=i,s&&onFinishNavigation(t,i)):(i&&(Model.clear(),Model.searchTerm=i,App.view.searchInput.value=i),App.view.searchResults.replaceChildren(stringToHTML('<div class="text-center"><span class="loading loading-spinner loading-md text-stat-gold"></span></div>')),fetchHtmlContent(App.baseurl+"/"+t+"/all.html",e=>{e=stringToHTML(e),e=convertHtmlToItems(e);App.view.searchInput.value=i,s&&onFinishNavigation(t,i),Model.initCategory(t,e)},e=>{console.log(e)})),Tooltips.hideAll()},bindItemNavEvents(e){signaller&&signaller.abort(),signaller=new AbortController,e=e||App.view.searchResults,findAll(e,"[data-nav]").forEach(e=>{App.isMobile&&e.dataset.hasOwnProperty("tooltip")||on(e,"click",e=>{var t;e.currentTarget&&"details"===e.currentTarget.dataset.nav?(e.preventDefault(),t=new URL(e.currentTarget.href).pathname.replace(App.baseurl,""),Tooltips.modalDialogEl?.close(),App.goToDetails(t)):e.currentTarget&&e.currentTarget.dataset.nav&&e.currentTarget.dataset.nav.includes("+")&&(e.preventDefault(),(t=parseHash(e.currentTarget.dataset.nav)).category)&&t.search&&App.goToCategory(t.category,t.search)})})},updateNav(){findAll(App.view.navList,"[data-nav]").forEach(e=>{e.classList.remove("active"),Model.details||e.dataset.nav===Model.searchCategory&&e.classList.add("active")})},updateClearButton(){App.view.searchInput.value?App.view.clearButton.classList.remove("invisible"):App.view.clearButton.classList.add("invisible")},createDetailItem(e){let t="";return t="Back"===e.type||"Bow"===e.type||"Chest"===e.type||"Helmet"===e.type||"Legs"===e.type||"OneHandedWeapon"===e.type||"TwoHandedWeapon"===e.type||"Shield"===e.type||"Tool"===e.type?`
        <div class="result card basis-full md:max-w-sm p-1 rounded-md border-2 border-base-200 text-left text-sm bg-wood-panel" style="background-position:0;">
          <div class="h-full p-2 rounded-md border-none bg-black/30">
            ${e.content.outerHTML}
          </div>
        </div>`:`
        <div class="result card basis-full max-w-3xl p-1 rounded-md border-2 border-base-200 text-left text-sm bg-wood-panel" style="background-position:0;">
          <div class="h-full p-2 rounded-md border-none bg-black/30">
            ${e.content.outerHTML}
          </div>
        </div>`,stringToHTML(t)},createResultItem(e){return stringToHTML(e.template)},render(){App.updateNav(),App.updateClearButton(),Model.details?App.view.searchResults.replaceChildren(App.createDetailItem(Model.details)):App.view.searchResults.replaceChildren(...Model.visibleItems.map(e=>App.createResultItem(e))),App.bindItemNavEvents(),Tooltips.bindEvents()}};App.init("/vdb",!!window.mobileAndTabletCheck&&window.mobileAndTabletCheck());